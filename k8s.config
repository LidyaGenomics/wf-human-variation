/*
 * Kubernetes executor configuration for Huawei Cloud CCE.
 *
 * Customize the values below for your cluster, then run:
 *
 *   nextflow run main.nf \
 *       -profile k8s \
 *       -c k8s.config \
 *       -w /opt/ont_runs/work \
 *       --bam /opt/ont_runs/input.bam \
 *       --ref /opt/FASTA/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna \
 *       --sample_name SAMPLE \
 *       --snp --sv --phased \
 *       --out_dir /opt/ont_runs/output
 */

k8s {
    namespace = 'default'

    // PVC for the Nextflow work directory. This PVC is auto-mounted on all
    // spawned task pods. Input BAM/BED and output files should also live here.
    storageClaimName = 'obsfs-files-pvc'
    storageMountPath = '/opt/ont_runs'
    storageSubPath   = 'ont_runs'

    // Additional pod configuration applied to every spawned task pod.
    pod = [
        // Mount reference genome PVC (read-only)
        [volumeClaim: 'lidya-data-pvc', mountPath: '/opt/FASTA', subPath: 'datasets/FASTA', readOnly: true],

        // Mount BAM files PVC
        [volumeClaim: 'obsfs-files-pvc', mountPath: '/opt/ont_bams', subPath: 'ont_bams'],

        // Image pull secrets (for private registry or to avoid Docker Hub rate-limits)
        [imagePullSecret: 'container-registry-credentials'],
        [imagePullSecret: 'container-registry-credentials-swr'],

        // CCE autopilot: request ephemeral storage for temporary files
        [annotation: 'resource.cce.io/extra-ephemeral-storage-in-GiB', value: '100'],
    ]
}
